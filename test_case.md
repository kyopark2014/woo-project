검색 결과를 바탕으로 픽업필터 off일 시에 대한 정보를 정리하고 테스트 케이스를 작성하겠습니다.

# 픽업필터 off일 시 정보 및 테스트 케이스

## 픽업필터 off일 시 주요 정책 및 특징

1. **기본 정책**:
   - 픽업필터 OFF 시, 기존 배달탭 노출 정책을 따름
   - 배달 응답 스펙만 제공하고, 포장의 상태는 null로 처리됨

2. **가게 노출 정책**:
   - "baemin", "baeminOne", "stod"의 displayable, finalOperation 값을 기준으로 판단
   - displayable: true → 가게 노출/미노출을 판단 (false: 가게 미노출)
   - finalOperation: true → 가게 운영중/준비중을 판단 (false: 가게 준비중)

3. **노출 조건**:
   - status: open
   - ongoing: 배민1플러스/오픈리스트/울트라콜/파워콜 중 하나가 있어야 함
   - baropay(바로결제): 
     - OD only인 경우, 바로결제 사용 true일 때 노출
     - MP only인 경우, 바로결제 사용 true/false 상관없이 노출
     - OD + MP를 모두 이용하는 경우, 바로결제 사용여부로 노출을 필터링하지 않음

4. **추천 리랭킹 결과**:
   - 픽업필터 "Off" 일 시에는 추천리랭킹결과가 1위~25위 노출됨
   - 추천리랭킹결과 중 운영중 주문유형을 대상으로 하며, 준비중이면 displayable=false로 노출

5. **브로스(OD) 노출 조건**:
   - serviceable = true (false이면 미노출)
   - 센터ID 일치
   - 배달반경:
     - MP인 경우 배달권역(S2)과 교집합인 경우 노출
     - OD인 경우 한집(4km), 알뜰(3km) 각각 반경 안에 있을 경우 노출

## 테스트 케이스

### 테스트 케이스 1: 픽업필터 OFF 시 기본 응답 스펙 검증

**목적**: 픽업필터 OFF 시 배달 응답 스펙만 제공되고 포장 상태가 null로 처리되는지 확인

**전제 조건**:
- 테스트 환경에 배달 및 픽업 서비스를 제공하는 가게 데이터가 있음
- 픽업필터가 OFF 상태로 설정됨

**테스트 단계**:
1. 검색 API를 호출하여 가게 목록을 요청
2. 응답 데이터에서 가게 정보를 확인

**예상 결과**:
- 응답에 배달 관련 정보만 포함되어 있음
- 포장(픽업) 관련 정보는 null로 처리됨
- 각 가게의 pickup 필드가 null 또는 {displayable: false, finalOperation: true} 형태로 설정됨

**검증 항목**:
```json
{
  "shops": [
    {
      "id": "shop123",
      "name": "테스트 가게",
      "baemin": {
        "displayable": true,
        "finalOperation": true
      },
      "baeminOne": {
        "displayable": true,
        "finalOperation": true
      },
      "stod": {
        "displayable": true,
        "finalOperation": true
      },
      "pickup": null
    }
  ]
}
```

### 테스트 케이스 2: 픽업필터 OFF 시 가게 노출 조건 검증

**목적**: 픽업필터 OFF 시 기존 배달탭 노출 정책에 따라 가게가 올바르게 노출되는지 확인

**전제 조건**:
- 다양한 상태의 가게 데이터가 준비됨 (운영중/준비중, 바로결제 사용/미사용 등)
- 픽업필터가 OFF 상태로 설정됨

**테스트 단계**:
1. 검색 API를 호출하여 가게 목록을 요청
2. 응답 데이터에서 가게 노출 여부를 확인

**테스트 데이터**:
1. 가게 A: status=open, ongoing=배민1플러스, baropay=true, OD only
2. 가게 B: status=open, ongoing=울트라콜, baropay=false, MP only
3. 가게 C: status=open, ongoing=파워콜, baropay=false, OD only
4. 가게 D: status=closed, ongoing=오픈리스트, baropay=true, MP+OD

**예상 결과**:
- 가게 A: 노출됨 (OD only이지만 baropay=true)
- 가게 B: 노출됨 (MP only는 baropay 상관없이 노출)
- 가게 C: 미노출 (OD only이고 baropay=false)
- 가게 D: 미노출 (status=closed)

**검증 항목**:
- 응답의 shops 배열에 가게 A, B만 포함되어 있는지 확인
- 각 가게의 displayable, finalOperation 값이 예상대로 설정되었는지 확인

### 테스트 케이스 3: 픽업필터 OFF 시 추천 리랭킹 결과 검증

**목적**: 픽업필터 OFF 시 추천리랭킹결과가 1위~25위까지 올바르게 노출되는지 확인

**전제 조건**:
- 30개 이상의 가게 데이터가 준비됨
- 픽업필터가 OFF 상태로 설정됨

**테스트 단계**:
1. 검색 API를 호출하여 가게 목록을 요청
2. 응답 데이터에서 가게 목록의 수와 순서를 확인

**예상 결과**:
- 응답에 최대 25개의 가게 정보가 포함됨
- 가게 순서가 추천 리랭킹 결과에 따라 정렬됨

**검증 항목**:
- 응답의 shops 배열의 길이가 25 이하인지 확인
- 준비중인 가게는 displayable=false로 설정되었는지 확인

### 테스트 케이스 4: 픽업필터 OFF 시 브로스(OD) 노출 조건 검증

**목적**: 픽업필터 OFF 시 브로스(OD) 가게의 노출 조건이 올바르게 적용되는지 확인

**전제 조건**:
- 다양한 위치와 배달 반경을 가진 OD 가게 데이터가 준비됨
- 픽업필터가 OFF 상태로 설정됨

**테스트 단계**:
1. 특정 위치(좌표)를 기준으로 검색 API를 호출
2. 응답 데이터에서 OD 가게의 노출 여부를 확인

**테스트 데이터**:
1. 가게 A: serviceable=true, 센터ID 일치, 한집배달 반경 내(3km)
2. 가게 B: serviceable=true, 센터ID 일치, 알뜰배달 반경 내(2km)
3. 가게 C: serviceable=false, 센터ID 일치, 한집배달 반경 내(3km)
4. 가게 D: serviceable=true, 센터ID 불일치, 한집배달 반경 내(3km)
5. 가게 E: serviceable=true, 센터ID 일치, 배달 반경 외(5km)

**예상 결과**:
- 가게 A, B: 노출됨
- 가게 C, D, E: 미노출됨

**검증 항목**:
- 응답의 shops 배열에 가게 A, B만 포함되어 있는지 확인
- 각 가게의 serviceable, 센터ID, 배달 반경 정보가 예상대로 설정되었는지 확인

### 테스트 케이스 5: 픽업필터 OFF에서 ON으로 전환 시 동작 검증

**목적**: 픽업필터를 OFF에서 ON으로 전환할 때 응답 스펙이 올바르게 변경되는지 확인

**전제 조건**:
- 배달 및 픽업 서비스를 모두 제공하는 가게 데이터가 준비됨
- 초기 상태는 픽업필터 OFF로 설정됨

**테스트 단계**:
1. 픽업필터 OFF 상태에서 검색 API를 호출하여 가게 목록을 요청
2. 픽업필터를 ON으로 변경
3. 동일한 검색 조건으로 검색 API를 다시 호출
4. 두 응답 데이터를 비교

**예상 결과**:
- 픽업필터 OFF 시: 배달 응답 스펙만 제공, 포장 상태는 null
- 픽업필터 ON 시: 배달 응답 스펙(null) + 포장 운영 상태 정보 함께 제공
- 픽업필터 ON 시: "배달광고 + 픽업광고"를 모두 가입한 가게만 노출

**검증 항목**:
- 픽업필터 OFF 응답에서 pickup 필드가 null인지 확인
- 픽업필터 ON 응답에서 pickup 필드에 운영 상태 정보가 포함되어 있는지 확인
- 픽업필터 ON 응답에 "배달광고 + 픽업광고" 가입 가게만 포함되어 있는지 확인

## 테스트 실행 방법

1. 테스트 환경 설정:
   - 테스트용 데이터베이스에 다양한 상태의 가게 데이터 준비
   - 테스트 API 엔드포인트 설정

2. 테스트 실행:
   - 각 테스트 케이스를 순차적으로 실행
   - API 응답을 로깅하여 예상 결과와 비교

3. 결과 검증:
   - 각 테스트 케이스의 검증 항목을 확인
   - 불일치가 있는 경우 원인 분석 및 수정

4. 회귀 테스트:
   - 수정 후 모든 테스트 케이스를 다시 실행하여 기존 기능이 정상 동작하는지 확인

이 테스트 케이스들은 픽업필터 OFF 상태에서의 기능을 검증하기 위한 기본적인 테스트입니다. 실제 구현 환경과 요구사항에 따라 추가적인 테스트 케이스가 필요할 수 있습니다.